-----Loot Log-----

storage.lootLog = storage.lootLog or {}
storage.maxLootLines = tonumber(storage.maxLootLines) or 1000
storage.lootCount = storage.lootCount or 0
local lootTab = addTab("Loot Log")
local function addLootLine(text)
  storage.lootCount = storage.lootCount + 1
  local line = string.format("%d. [%s] %s", storage.lootCount, os.date("%H:%M:%S"), text)
  table.insert(storage.lootLog, 1, line)
  while #storage.lootLog > storage.maxLootLines do
    table.remove(storage.lootLog)
  end
end

local function updateLootUI()
  lootTab:destroyChildren()
  lootTab:addChild(UI.Label("Loot Log:"))

  lootTab:addChild(UI.Button("Wyczysc loot log", function()
    storage.lootLog = {}
    storage.lootCount = 0 
    updateLootUI()
  end))

  lootTab:addChild(UI.Separator())

  lootTab:addChild(UI.Label("Max. liczba wpisow(zalecane 400):"))
  local input = UI.TextEdit(tostring(storage.maxLootLines), function(widget, text)
    local val = tonumber(text)
    if val and val >= 1 then
      storage.maxLootLines = val
    else
      widget:setText(tostring(storage.maxLootLines))
    end
  end)
  lootTab:addChild(input)

  lootTab:addChild(UI.Separator())

  for _, line in ipairs(storage.lootLog) do
    lootTab:addChild(UI.Label(line))
  end
end

onTextMessage(function(mode, text)
  if text:lower():find("loot of a ") then
    addLootLine(text)
    updateLootUI()
  end
end)

updateLootUI()

--licznik mobow---
local licznikIcon = nil
macro(1000, function()
  if licznikIcon then
    licznikIcon:destroy()
  end
  licznikIcon = addIcon("Licznik", {item = {id = 11676, count = 1}, text = "Zabito: " .. storage.lootCount }, function() end)
end)
